# 湖南师范大学江湾体育馆羽毛球场预约脚本 (新版组队)

## 📖 项目简介

本项目是针对湖南师范大学体育场馆预约系统（新版）的自动化预约脚本。

它基于新版的**组队预约**规则，通过 **Selenium** 模拟登录信息门户，自动获取时效性凭证（Token 和 Cookie），并在指定时间（默认为早上 `07:00:00`）自动执行“盲抢”预约。

### ✨ 核心功能

* **多账号支持：** 可在 `ACCOUNTS` 列表中配置任意多个账号。
* **并行登录：** 脚本启动时，会**并行**登录所有配置的账号，高效获取凭证。
* **并发预约：** 到达设定时间后，所有账号会**并发**（同时）发起预约请求，最大化抢票成功率。
* **"盲抢" 模式：** 脚本**不会**先查询场地是否可用，而是直接在 `07:00:00` 尝试预约您在 `target_times` 中设置的偏好时间，这是最快的抢票策略。
* **自动重试：** 脚本使用精确定时器，每天自动在 `RUN_AT_TIME` 设定的时间执行。
* **优先级预约：** `target_times` 是一个列表，脚本会按顺序尝试预约，直到成功一个为止。

---

## ⚠️ 重要限制与提示

> * **非全自动脚本：** 本脚本**未实现**全自动组队。您**必须**在运行脚本前，手动登录系统网页完成组队。
> * **ID必须一致：** 您在系统中手动组队的**搭档ID**，必须与脚本 `ACCOUNTS` 配置中的 `partner_id` **完全一致**。
> * **Token 时效性：** 脚本获取的 `auth_token` 和 `cookie` **有效期仅有 2 小时**。
> * **执行时机：** 强烈建议在**场馆开放预约前 1 小时内**（例如 06:30）启动脚本。

---

## 🛠️ 环境准备

在运行脚本前，您需要安装 Python 和必要的库。

1.  **安装 Python 3.x：** (请自行从官网 [python.org](https://www.python.org/) 下载安装)
2.  **安装 Chrome 浏览器：** 脚本需要 `webdriver-manager` 自动下载匹配您 Chrome 版本的驱动。
3.  **安装 Python 依赖库：**
    ```bash
    pip install requests selenium webdriver-manager
    ```

---

## ⚙️ 配置脚本

打开 `auto_booking_new.py` 脚本文件，找到顶部的 `(1) 配置区`，根据您的需求修改。

### 1. 账号配置 (ACCOUNTS)

这是最核心的配置。您可以添加一个或多个账号。

```python
ACCOUNTS = [
    {
        "username": "张三",  # 你的名字 (仅用于日志显示)
        "login_user": "202330000000",  # 登录信息门户的学号
        "login_pass": "123456",  # 登录信息门户的密码
        "partner_id": "202330000001",  # 预约时填写的同伴学号/ID
        "target_room_id": "1971114735505211392",    # 目标场地ID (见下方列表)
        "target_times": ["10:00-11:00", "09:30-10:30"], # 偏好时间 (按顺序尝试)
        "auth_token": "",  # 自动获取，无需填写
        "cookie": "",  # 自动获取，无需填写
    },
    {
        "username": "李四",
        "login_user": "202330000003",
        "login_pass": "123456",
        "partner_id": "202330000004",
        "target_room_id": "1971115407462072320",
        "target_times": ["10:00-11:00"], # 只想抢这一个时间
        "auth_token": "",
        "cookie": "",
    },
    # --- 在此添加更多账号 ---
]
```

**场地ID (`target_room_id`) 列表：**

* 1号场：`1971114235883913216`
* 2号场：`1971114398220255232`
* 3号场：`1971114735505211392`
* 4号场：`1971115407462072320`
* 5号场：`1971115552459161600`
* 6号场：`1971115609979846656`

### 2. 全局配置

```python
# 预约几天后的场地 (0: 今天, 1: 明天, 2: 后天)
# 现需要提前7天查看，提前6天预约
BOOK_DAYS_AHEAD = 6

# 设置脚本每天自动运行的时间 (24小时制, 格式 "HH:MM:SS")
# 现系统设置为每天早上7点开启预约
RUN_AT_TIME = "07:00:00"

# 是否在启动脚本时立即执行一次预约任务 (方便测试)
# 建议：测试时设为 True, 实际抢票时设为 False
RUN_ON_STARTUP = True
```

---

## 🏃‍♂️ 运行脚本

### 步骤一：手动完成组队（必须！）

这是**最关键**的一步。脚本无法自动组队，必须手动在网页上设置。

1.  登录信息门户：`https://front.hunnu.edu.cn/index`
2.  选择“体育场馆预约”应用。
    <img width="2444" alt="登录信息门户" src="https://github.com/user-attachments/assets/cfb1d8c6-4135-4cec-a203-e6081afbd4a2" />
3.  在顶部菜单选择“组队预约”，并**完成组队**。（确保搭档ID与脚本中的 `partner_id` 一致）
    <img width="2422" alt="选择组队预约" src="https://github.com/user-attachments/assets/06d15fb3-34e8-4879-871b-c64a8521ecd1" />

### 步骤二：启动脚本

在您配置好脚本后，在命令行中运行它：

```bash
auto_booking_new.py
```

### 步骤三：观察脚本执行

1.  **并行登录 & 获取凭证**
    脚本启动后，会立即为 `ACCOUNTS` 列表中的所有账号**并行**执行登录操作，获取凭证。
    <img width="2286" alt="获取Token和Cookie" src="https://github.com/user-attachments/assets/cc2eeb04-3742-4312-b2ba-df3f3b3bb496" />
2.  **检查组队信息 (预请求)**
    脚本会发送预请求，检查您的账户是否已正确组队。（这是 `book_venue_for_account_new` 函数的一部分）
    <img width="1625" height="343" alt="image" src="https://github.com/user-attachments/assets/e2b27f9d-63e6-4a33-8110-a035217ebfc8" />
4.  **测试运行 (如果 `RUN_ON_STARTUP = True`)**
    如果 `RUN_ON_STARTUP` 为 `True`，脚本会**立即**尝试执行一次预约。此时通常不是预约时间，您会看到“未到预约时间”或“已被预约”的提示，这是**正常现象**。
    <img width="1604" alt="初次预约尝试" src="https://github.com/user-attachments/assets/deb4e180-1012-42b8-8855-573a8acf1fd3" />
5.  **进入定时等待**
    测试运行（或跳过测试）后，脚本将进入等待状态，计算距离 `RUN_AT_TIME` (例如 07:00:00) 的时间。
    <img width="969" alt="等待定时执行" src="https://github.com/user-attachments/assets/2719aa97-2ad3-4ccd-9909-d4a557f3d9c4" />
6.  **正式预约**
    到达 `07:00:00` 时，脚本会为所有账号**并发**（同时）发送预约请求。

**重要：启动脚本后，请保持此命令行窗口运行，不要关闭！**

---

## 💡 故障排查

* **登录失败：** 如果 Selenium 模拟登录时出错（例如密码错误、网页结构变化），脚本会保存一张名为 `{username}_error_final.png` 的截图，帮助您定位问题。
* **预约失败 (Msg)：**
    * `"未到预约时间"`：正常现象，说明抢早了，脚本会在 `RUN_AT_TIME` 准时重试。
    * `"已被预约"`：正常现象，说明手慢了，或者这个时间段已被别人抢走。
    * **关于组队 (Team) 的错误**：请返回**步骤一**，仔细检查您是否已在网页上手动组队，并且 `partner_id` 是否填写正确。
